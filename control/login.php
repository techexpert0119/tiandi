<?if( substr_count( $_SERVER['PHP_SELF'], 'login.php' ) ) {  @include_once('functions.inc.php');   login_check(); }else {  login_check();   return ;}?><!DOCTYPE html><html lang="en">   <head>     <title><?= $globvars['comp_name'] ; ?> - Login</title>     <link rel="stylesheet" type="text/css" href="styles.css">   </head>   <body>     <? globvars('goto'); ?>    <div style="margin:0 auto; text-align:center; padding:10px 0;">       <p><img src="<?= $globvars['admin_logo'] ?>" border="0" alt="<?= $globvars['comp_name'] ; ?>" width="170"></p>      <h1>PLEASE LOGIN</h1>       <div class="box corners">         <form method="post" action="<?= $php_self ; ?>">           <table border="0" cellpadding="3" cellspacing="0" summary="">             <tr>               <td><b>Username</b></td>               <td><input type="text" name="cntrl_user" size="20" value=""></td>             </tr>             <tr>               <td><b>Password</b></td>               <td><input type="password" name="cntrl_pass" size="20" value=""></td>             </tr>             <tr>               <td><input type="hidden" name="goto" value="<?= $globvars['goto'] ?>"></td>               <td><input type="submit" name="submit" value="LOGIN" class="submit"></td>             </tr>           </table>         </form>      </div>    </div><?function login_check() {  global $globvars ;  $globvars['cntrl_admin'] = $user = $loginok = '';  $globvars['cntrl_pages'] = array();  if(false && $globvars['local_dev']) {    // remove false to disable localhost login    $globvars['cntrl_admin'] = $loginok = 'y' ;    $user = 'Admin';    if($globvars['php_self'] == 'login.php') {      header('location:index.php');    }  }  else {    opendb();    if($globvars['query_string'] == 'logout') {      if($globvars['sessmd']) {        // logout        $string = "UPDATE `admin_users` SET `upsession` = '' WHERE `upsession` = '{$globvars['sessmd']}' LIMIT 1";        $query = my_query($string);        if($globvars['php_self'] != 'login.php') {          header('location:login.php');        }      }    }    else {      globvars('cntrl_user','cntrl_pass','goto');      if($globvars['cntrl_user'] && $globvars['cntrl_pass']) {        // check login        $md5pass = md5($_POST['cntrl_pass']);        $string = "SELECT * FROM `admin_users` WHERE `username` = '{$globvars['cntrl_user']}' AND `password` = '$md5pass' LIMIT 1";        $query = my_query($string);        if(my_rows($query)) {          $a_row = my_assoc($query);          $string = "UPDATE `admin_users` SET `upsession` = '{$globvars['sessmd']}' WHERE `username` = '{$globvars['cntrl_user']}' AND `password` = '$md5pass' LIMIT 1";          $query = my_query($string);          $loginok = 'y' ;          $user = $globvars['cntrl_user'] ;          if(isset($a_row['administrator']) && isset($a_row['pages'])) {            $globvars['cntrl_admin'] = $a_row['administrator'] ;            $globvars['cntrl_pages'] = explode(",",$a_row['pages']) ;          }          else {            $globvars['cntrl_admin'] = 'y' ;            $globvars['cntrl_pages'] = '' ;          }          logtable('LOGIN',$user,'admin_users','LOGIN');        }      }      elseif($globvars['sessmd']) {        // check session        $string = "SELECT * FROM `admin_users` WHERE `upsession` = '{$globvars['sessmd']}' LIMIT 1";        $query = my_query($string);        if(my_rows($query)) {          $loginok = 'y' ;          $a_row = my_assoc($query);          $user = $a_row['username'];          if(isset($a_row['administrator']) && isset($a_row['pages'])) {            $globvars['cntrl_admin'] = $a_row['administrator'] ;            $globvars['cntrl_pages'] = explode(",",$a_row['pages']) ;          }          else {            $globvars['cntrl_admin'] = 'y' ;          }        }      }      $goto = ($globvars['php_self'] == 'login.php' && $globvars['goto']) ? $globvars['goto'] : $globvars['php_self'];      if($loginok && ! ( in_array( $globvars['php_self'], array('index.php','login.php','listfiles.php','jselect.php') ) || $globvars['cntrl_admin'] || in_array($goto, $globvars['cntrl_pages'] ) ) ) {        // access not allowed to page        header('location:index.php');      }      elseif($loginok && $globvars['php_self'] == 'login.php') {        // redirect to page        $goto = $globvars['goto'] ? $globvars['goto'] : 'index.php';        header('location:' . $goto);      }      elseif((! $loginok) && $globvars['php_self'] != 'login.php') {        // go to login        header('location:login.php?goto=' . $globvars['php_self']);      }    }  }  $globvars['cntrl_user'] = $user ;  $_SESSION['admin_login'] = $loginok ;}?>  </body></html>